# 徒步活动组织系统

## 📖 项目简介

为苏州和上海周边的徒步爱好者提供自动化轻徒步活动组织服务，降低组织难度，提升活动效率。

### 核心特点

- **轻徒步定位**：当天来回，不住宿，天黑前下山
- **公益性质**：组织者不收取服务费
- **安全第一**：确保所有活动在天黑前完成
- **智能自动化**：从路线推荐到建群机器人，全流程自动化

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 本地运行

```bash
cd hike-organizer
streamlit run app.py
```

### 3. 访问系统

打开浏览器访问：`http://localhost:8501`

## 🔧 配置说明

### 3.1 获取API密钥

#### 和风天气API（免费）

1. 访问：https://dev.qweather.com/
2. 注册账号并登录
3. 进入「控制台」→「应用管理」→「创建应用」
4. 选择「Web API」类型
5. 创建后复制「Key」

#### 企业微信机器人（免费）

1. 访问：https://work.weixin.qq.com/
2. 创建企业微信账号（免费）
3. 在群聊中添加机器人
4. 获取机器人的Webhook URL

### 3.2 配置环境变量

在Streamlit侧边栏中输入：

- **企业微信Webhook URL**：用于发送消息到微信群
- **和风天气API Key**：用于获取天气预报

### 3.3 Streamlit Secrets（可选）

如果要在部署环境使用，创建 `.streamlit/secrets.toml` 文件：

```toml
WEATHER_API_KEY = "your_api_key"
WECHAT_WEBHOOK_URL = "your_webhook_url"
```

## 📋 使用流程

### 步骤1：路线选择

1. 选择地点（苏州/上海）
2. 点击「刷新路线」获取最新路线
3. 浏览推荐路线并选择一条
4. 点击「确认选择」

### 步骤2：海报制作

1. **选择主题词**：系统自动生成或自定义
2. **选择背景图片**：搜索或上传自定义图片
3. **选择投票月份**：默认下个月，可手动调整
4. **生成投票选项**：系统自动获取天气信息
5. **设置截止时间**：默认5天后
6. **生成海报**：合成海报和投票二维码

### 步骤3：投票与建群

1. **发布海报**：将海报发送到微信群
2. **监控投票**：等待群成员投票
3. **确定日期**：选择得票最多的日期
4. **创建活动群**：自动建群并发送欢迎消息
5. **机器人激活**：机器人开始自动回答问题

## 🤖 机器人功能

### 自动回复

机器人在活动群中会自动回答以下问题：

- 活动费用多少？
- 需要带什么装备？
- 集合时间和地点？
- 活动难度如何？
- 天气怎么样？
- 如何报名参加？
- 报名截止时间？
- 可以带朋友吗？
- 可以取消报名吗？
- 有保险吗？
- 如果中途放弃怎么办？
- 紧急联系方式？
- 需要准备午餐吗？
- 有厕所吗？
- 可以带宠物吗？

### 问题热度排序

问题按点击热度从高到低排列，常见问题优先显示。

## 🗂️ 项目结构

```
hike-organizer/
├── app.py                    # Streamlit主应用
├── requirements.txt          # Python依赖包
├── README.md                # 说明文档
├── data/
│   └── hike.db             # SQLite数据库
├── assets/
│   └── poster_*.png        # 生成的海报
└── utils/
    ├── __init__.py
    ├── database.py         # 数据库操作
    ├── crawler.py          # 两步路爬虫
    ├── poster.py           # 海报生成
    ├── weather.py          # 天气API
    └── wechat.py           # 微信集成
```

## 🌐 部署到云平台

### Streamlit Cloud（推荐）

1. 将代码推送到GitHub
2. 访问：https://share.streamlit.io/
3. 点击「New app」
4. 关联GitHub仓库
5. 配置环境变量
6. 点击「Deploy」

### Hugging Face Spaces

1. 访问：https://huggingface.co/spaces
2. 点击「Create new Space」
3. 选择「Streamlit」SDK
4. 上传代码
5. 配置环境变量
6. 等待部署完成

## 📊 数据库结构

### 主要数据表

- **routes**：路线信息
- **activities**：活动信息
- **votes**：投票选项
- **faq**：问题库
- **users**：用户信息
- **messages**：群消息记录

## 🔒 隐私说明

- 所有数据存储在本地数据库
- 不收集任何个人敏感信息
- 微信机器人仅在授权群聊中工作

## 🐛 常见问题

### Q1：海报生成失败？

**A**：检查是否安装了中文字体，或更换为英文字体。

### Q2：微信消息发送失败？

**A**：
- 检查Webhook URL是否正确
- 检查企业微信机器人是否过期（有效期90天）
- 检查网络连接

### Q3：天气显示为"暂无数据"？

**A**：
- 检查和风天气API Key是否正确
- 检查API调用次数是否超限（免费版每天1000次）

### Q4：爬虫无法获取数据？

**A**：
- 目前使用模拟数据用于开发测试
- 实际使用时需要配置代理或更新爬虫规则

## 📈 后续计划

- [ ] 智能体2开发（服务参与者）
- [ ] 智能体3开发（协调优化）
- [ ] 接入真实的两步路API
- [ ] 支持多群管理
- [ ] 活动数据统计和分析
- [ ] 移动端适配

## 📝 许可证

本项目为公益项目，仅供学习交流使用。

## 🙏 致谢

- 两步路：提供徒步路线数据
- 和风天气：提供天气预报服务
- Streamlit：提供Web框架
- Pexels：提供免费高清图片

---

**联系方式**：如有问题或建议，欢迎通过微信群反馈。

**版本**：v1.0
**更新日期**：2026-02-16
