# 徒步活动组织系统 - 快速使用指南

## 🚀 快速开始（3分钟上手）

### 方式一：本地运行（推荐新手）

#### 1. 确保已安装Python
打开终端，输入：
```bash
python3 --version
```
如果显示版本号（如Python 3.10+），说明已安装。

#### 2. 进入项目目录
```bash
cd hike-organizer
```

#### 3. 安装依赖包
```bash
pip3 install -r requirements.txt
```
等待安装完成（约2-3分钟）。

#### 4. 启动应用
```bash
streamlit run app.py
```

#### 5. 打开浏览器
访问：`http://localhost:8501`

---

### 方式二：一键启动脚本

如果您在Mac/Linux系统上，可以直接运行：
```bash
chmod +x start.sh
./start.sh
```

---

## ⚙️ 首次配置（5分钟）

### 步骤1：获取和风天气API Key（免费）

1. 访问：https://dev.qweather.com/
2. 点击右上角「注册」
3. 填写信息完成注册（免费）
4. 登录后，点击「控制台」
5. 点击「应用管理」→「创建应用」
6. 填写应用信息：
   - 应用名称：徒步活动组织系统
   - 应用类型：Web API
7. 创建后，复制「Key」（一串字符）

### 步骤2：获取企业微信机器人Webhook（免费）

1. 访问：https://work.weixin.qq.com/ （或使用手机企业微信APP）
2. 创建一个群聊（用于测试）
3. 点击群右上角「...」→「群机器人」→「添加机器人」
4. 给机器人起个名字（如：徒步小助手）
5. 复制Webhook URL（以 `https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=...` 开头）

### 步骤3：在系统中配置

1. 打开浏览器访问：`http://localhost:8501`
2. 在左侧边栏找到「微信配置」
3. 粘贴刚才复制的Webhook URL
4. 在「天气API」栏中粘贴和风天气API Key
5. 配置完成！

---

## 📋 完整使用流程（组织一次活动）

### 步骤1：选择路线（2分钟）

1. 在「路线选择」标签页，选择地点（苏州或上海）
2. 点击「🔄 刷新路线」按钮
3. 浏览推荐的3条路线（按热度排序）
4. 点击「➡️ 下一页」查看更多路线
5. 在下拉框中选择一条路线
6. 点击「确认选择」
7. 系统提示：👉 请前往「海报制作」标签页继续

**示例**：
- 路线：东山环线·碧螺春茶园之旅
- 里程：12.5公里
- 爬升：650米
- 时长：5.5小时

---

### 步骤2：制作海报（5分钟）

#### 2.1 选择主题词
- 系统自动生成6个主题词（如：春日赏花、山野徒步、周末逃离等）
- 在下拉框中选择一个
- 或选择「自定义」，输入自己的主题词

#### 2.2 选择背景图片
- **方式A**：点击「🔍 搜索图片」，从搜索结果中选择一张
- **方式B**：点击「上传自定义图片」，上传自己的照片

#### 2.3 选择投票月份
- 默认显示下一个月（如当前2月，默认3月）
- 可以手动修改年份和月份
- 系统会自动生成该月所有周六和周日

#### 2.4 生成投票选项
- 点击「🔄 生成投票选项」
- 系统自动获取每个日期的天气预报
- 例如：
  - 2026-03-01（周六）：晴，15-25℃
  - 2026-03-02（周日）：多云，14-24℃

#### 2.5 设置投票截止时间
- 默认：投票开始后5天
- 可以手动调整截止时间

#### 2.6 生成海报
- 点击「✨ 生成海报」
- 等待几秒，海报生成完成
- 预览海报，确认无误
- 系统提示：👉 请前往「投票与建群」标签页继续

---

### 步骤3：投票与建群（10分钟）

#### 3.1 发布海报到微信群
1. 点击「📤 发布海报」
2. 海报自动发送到您配置的微信群
3. 包含：
   - 活动海报图片
   - 投票二维码
   - 投票链接

#### 3.2 监控投票
1. 群成员扫码或点击链接投票
2. 您可以在系统查看投票进度
3. 在投票选项旁输入当前票数（模拟）
4. 点击「📊 确定活动日期」

#### 3.3 创建活动群
1. 从下拉框选择得票最多的日期（如有平票，手动选择）
2. 点击「🚀 创建活动群并发送欢迎消息」
3. 系统自动：
   - 创建活动群
   - 机器人加入群聊
   - 发送欢迎消息
   - 显示常见问题列表

**欢迎消息示例**：
```
🎉 欢迎大家加入本次轻徒步活动群！

本次活动信息：
📍 路线：东山环线·碧螺春茶园之旅
📅 时间：2026-03-01（周六）
🏃 里程：12.5公里 | 爬升：650米
⏱️ 时长：5.5小时
💰 费用：公益免费（AA制交通费）

---

📋 常见问题快速入口：
1. 活动费用多少？
2. 需要带什么装备？
3. 集合时间和地点？
4. 活动难度如何？
5. 天气怎么样？
6. 如何报名参加？

有任何问题请直接在群里提问，机器人小助手会自动回复～
```

---

## 🤖 机器人自动回复功能

### 支持的问题列表

机器人在群中会自动回答以下问题（按热度排序）：

**费用相关**：
- 「活动费用多少？」
  - 回复：本次活动为公益性质，不收取服务费，仅收取AA制交通费用，具体金额在活动群内通知。

**装备相关**：
- 「需要带什么装备？」
  - 回复：请准备好徒步鞋、双肩背包、饮用水（1.5-2L）、午餐、防晒用品等。详细装备清单稍后发布。

**集合信息**：
- 「集合时间和地点？」
  - 回复：集合时间和地点会在活动前一天晚上群内通知，请关注群消息。

**难度咨询**：
- 「活动难度如何？」
  - 回复：本次路线为轻徒步，适合新手参与，全程有领队带领。

**天气查询**：
- 「天气怎么样？」
  - 回复：活动前3天会发布天气预报，请根据天气准备相应装备。

**报名相关**：
- 「如何报名参加？」
- 「报名截止时间？」
- 「可以带朋友吗？」
- 「可以取消报名吗？」

**安全相关**：
- 「有保险吗？」
- 「如果中途放弃怎么办？」
- 「紧急联系方式？」

**其他**：
- 「需要准备午餐吗？」
- 「有厕所吗？」
- 「可以带宠物吗？」

### 使用方式

群成员直接在群里提问，机器人会自动识别并回复。

例如：
```
群成员 A：活动费用多少？
机器人：本次活动为公益性质，不收取服务费，仅收取AA制交通费用，具体金额在活动群内通知。
```

---

## 💡 使用技巧

### 技巧1：批量管理多个活动

每次创建活动后，数据会自动保存到数据库。您可以：

1. 查看「数据」目录下的 `hike.db` 文件
2. 使用SQLite工具查看历史活动记录
3. 复用成功的路线和配置

### 技巧2：自定义问题库

如果需要添加更多问题，可以：

1. 打开 `utils/database.py`
2. 在 `init_faq_data()` 方法中添加新的问题
3. 重启应用

**示例添加问题**：
```python
("有停车位吗？", "集合点附近有免费停车场，建议提前到达。", "其他")
```

### 技巧3：海报定制

系统提供了多种海报定制选项：

- 自定义主题词
- 上传自己的照片作为背景
- 调整投票月份和选项

### 技巧4：多群管理

如果需要在多个群里发布活动：

1. 修改微信Webhook URL为新的群机器人
2. 重新发布海报
3. 重复投票和建群流程

---

## 🌐 部署到云端（可选）

如果想让团队其他成员也能使用，可以部署到云端：

### Streamlit Cloud（免费）

**优点**：
- 完全免费
- 自动部署
- 无需服务器

**步骤**：

1. **上传代码到GitHub**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/你的用户名/hike-organizer.git
   git push -u origin main
   ```

2. **部署到Streamlit Cloud**
   - 访问：https://share.streamlit.io/
   - 点击「New app」
   - 选择GitHub仓库
   - 配置环境变量：
     - `WEATHER_API_KEY`：你的和风天气API Key
     - `WECHAT_WEBHOOK_URL`：你的企业微信Webhook
   - 点击「Deploy」

3. **访问应用**
   - 部署完成后，会获得一个公网地址
   - 任何人都可以通过这个地址访问系统

### Hugging Face Spaces（免费）

**优点**：
- 更稳定
- 支持更多自定义配置

**步骤**：

1. 访问：https://huggingface.co/spaces
2. 点击「Create new Space」
3. 选择「Streamlit」SDK
4. 上传代码或关联GitHub仓库
5. 在Settings中配置环境变量
6. 等待部署完成

---

## 📊 常见问题排查

### Q1：启动时提示找不到模块？

**解决方案**：
```bash
pip3 install -r requirements.txt
```

### Q2：海报生成后显示乱码？

**原因**：缺少中文字体

**解决方案**：
- Windows：系统自带中文字体，无需处理
- Linux/Mac：安装中文字体包
  ```bash
  # Ubuntu/Debian
  sudo apt-get install fonts-wqy-zenhei

  # macOS
  brew install font-wqy-zenhei
  ```

### Q3：微信消息发送失败？

**检查项**：
1. Webhook URL是否正确（以 `https://qyapi.weixin.qq.com` 开头）
2. 企业微信机器人是否过期（有效期90天）
3. 网络连接是否正常

**解决方法**：
- 重新添加机器人获取新的Webhook URL
- 检查网络连接

### Q4：天气显示"暂无数据"？

**检查项**：
1. API Key是否正确
2. API调用次数是否超限（免费版每天1000次）

**解决方法**：
- 重新获取API Key
- 等待第二天重置调用次数

### Q5：爬虫无法获取真实路线数据？

**说明**：
- 当前版本使用模拟数据，便于快速上手
- 真实爬虫需要配置代理和更复杂的规则

**解决方案**：
- 直接使用模拟数据（已包含苏州和上海各9条路线）
- 后续版本会支持真实数据爬取

---

## 📞 获取帮助

如果遇到问题：

1. **查看日志**：
   - 终端中会显示详细的错误信息
   - 根据错误提示进行排查

2. **检查配置**：
   - 确认API Key和Webhook URL配置正确
   - 确认网络连接正常

3. **重启应用**：
   - 有时简单的重启可以解决问题
   - 按 `Ctrl+C` 停止应用
   - 重新运行 `streamlit run app.py`

---

## 🎉 开始使用吧！

现在您已经了解了如何使用系统，快去组织第一次徒步活动吧！

**建议首次使用流程**：

1. 本地运行系统
2. 配置API Key和Webhook
3. 选择一条简单的路线进行测试
4. 创建测试群进行完整流程演练
5. 熟悉后正式组织活动

祝活动组织顺利，徒步愉快！🚶‍♂️🚶‍♀️
